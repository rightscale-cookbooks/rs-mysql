<%- if node['mysql']['tunable']['skip-name-resolve'] %>
skip-name-resolve
<%- end %>

# * Fine Tuning
#
key_buffer_size         = <%= node['mysql']['tunable']['key_buffer_size'] %>
max_allowed_packet      = <%= node['mysql']['tunable']['max_allowed_packet'] %>
thread_stack            = <%= node['mysql']['tunable']['thread_stack'] %>
thread_cache_size       = <%= node['mysql']['tunable']['thread_cache_size'] %>
sort_buffer_size        = <%= node['mysql']['tunable']['sort_buffer_size'] %>
read_buffer_size        = <%= node['mysql']['tunable']['read_buffer_size'] %>
read_rnd_buffer_size    = <%= node['mysql']['tunable']['read_rnd_buffer_size'] %>
join_buffer_size        = <%= node['mysql']['tunable']['join_buffer_size'] %>

auto-increment-increment = <%= node['mysql']['auto-increment-increment'] %>
auto-increment-offset    = <%= node['mysql']['auto-increment-offset'] %>

# This replaces the startup script and checks MyISAM tables if needed
# the first time they are touched
myisam-recover          = <%= node['mysql']['tunable']['myisam-recover'] %>
max_connections         = <%= node['mysql']['tunable']['max_connections'] %>
max_connect_errors      = <%= node['mysql']['tunable']['max_connect_errors'] %>
concurrent_insert       = <%= node['mysql']['tunable']['concurrent_insert'] %>
connect_timeout         = <%= node['mysql']['tunable']['connect_timeout'] %>
wait_timeout            = <%= node['mysql']['tunable']['wait_timeout'] %>
net_read_timeout        = <%= node['mysql']['tunable']['net_read_timeout'] %>
net_write_timeout       = <%= node['mysql']['tunable']['net_write_timeout'] %>
back_log                = <%= node['mysql']['tunable']['back_log'] %>
<%- if node['mysql']['version'].to_f >= 5.6 %>
table_open_cache        = <%= node['mysql']['tunable']['table_open_cache'] %>
<%- else %>
table_cache             = <%= node['mysql']['tunable']['table_open_cache'] %>
<%- end %>

tmp_table_size          = <%= node['mysql']['tunable']['tmp_table_size'] %>
max_heap_table_size     = <%= node['mysql']['tunable']['max_heap_table_size'] %>
bulk_insert_buffer_size = <%= node['mysql']['tunable']['bulk_insert_buffer_size'] %>
open-files-limit        = <%= node['mysql']['tunable']['open-files-limit'] %>

# Default Table Settings
<%- if node['mysql']['tunable']['sql_mode'] %>
sql_mode                = "<%= node['mysql']['tunable']['sql_mode'] %>"
<%- end %>

#
# * Query Cache Configuration
#
query_cache_limit       = <%= node['mysql']['tunable']['query_cache_limit'] %>
query_cache_size        = <%= node['mysql']['tunable']['query_cache_size'] %>
#
# * Logging
#
# Both location gets rotated by the cronjob.
# Be aware that this log type is a performance killer.
#log            = /var/log/mysql/mysql.log
#
<%- if node['mysql']['tunable']['log_warnings'] %>
log_warnings
<%- end %>
#
# * Replication
#



long_query_time         = <%= node['mysql']['tunable']['long_query_time'] %>
<%- if node['mysql']['tunable']['log_queries_not_using_index'] and node['mysql']['tunable']['slow_query_log']  %>
log-queries-not-using-indexes
<%- end %>
#
# The following can be used as easy to replay backup logs or for replication.
# note: if you are setting up a replication slave, see README.Debian about
#       other settings you may need to change.
<%- if node['mysql']['tunable']['server_id'] %>
server-id = <%= node['mysql']['tunable']['server_id'] %>
<% end %>
<%- if node['mysql']['tunable']['log_bin'] %>
log_bin 		= <%= node['mysql']['tunable']['log_bin'] %>
binlog_format           = <%= node['mysql']['tunable']['binlog_format'] %>
log_slave_updates       = <%= node['mysql']['tunable']['log_slave_updates'] %>
<%- end %>
expire_logs_days        = <%= node['mysql']['tunable']['expire_logs_days'] %>
max_binlog_size         = <%= node['mysql']['tunable']['max_binlog_size'] %>
binlog_cache_size       = <%= node['mysql']['tunable']['binlog_cache_size'] %>



sync_binlog             = <%= node['mysql']['tunable']['sync_binlog'] %>
<%- if node['mysql']['tunable']['skip_slave_start'] %>
skip_slave_start
<%- end %>
<%- if node['mysql']['tunable']['read_only'] %>
read_only = 1
<%- end %>

<%- if node['mysql']['tunable']['transaction-isolation'] %>
transaction-isolation = <%= node['mysql']['tunable']['transaction-isolation'] %>
<%- end %>

<%- if node['mysql']['tunable']['slave_compressed_protocol'] %>
slave_compressed_protocol = <%= node['mysql']['tunable']['slave_compressed_protocol'] %>
<%- end %>
#
# * InnoDB
#
# InnoDB is enabled by default with a 10MB datafile in /var/lib/mysql/.
# Read the manual for more InnoDB related options. There are many!
# You might want to disable InnoDB to shrink the mysqld process by circa 100MB.
#skip-innodb

<%- if node["mysql"]["version"].to_f >= 5.5 %>
innodb_write_io_threads         = <%= node['mysql']['tunable']['innodb_write_io_threads'] %>
innodb_io_capacity              = <%= node['mysql']['tunable']['innodb_io_capacity'] %>
innodb_read_io_threads          = <%= node['mysql']['tunable']['innodb_read_io_threads'] %>
innodb_buffer_pool_instances    = <%= node['mysql']['tunable']['innodb_buffer_pool_instances'] %>
<%- end %>

## InnoDB Plugin Independent Settings
innodb_data_home_dir            = <%= node['mysql']['data_dir']  %>
innodb_log_group_home_dir       = <%= node['mysql']['data_dir']  %>


<%- if node['mysql']['tunable']['innodb_file_per_table'] %>
innodb_file_per_table
<%- end %>
innodb_table_locks              = <%= node['mysql']['tunable']['innodb_table_locks'] %>
innodb_lock_wait_timeout        = <%= node['mysql']['tunable']['innodb_lock_wait_timeout'] %>
innodb_thread_concurrency       = <%= node['mysql']['tunable']['innodb_thread_concurrency'] %>
innodb_commit_concurrency       = <%= node['mysql']['tunable']['innodb_commit_concurrency'] %>
innodb_support_xa               = <%= node['mysql']['tunable']['innodb_support_xa'] %>
<%- if node['mysql']['tunable']['skip-innodb-doublewrite'] %>
skip-innodb-doublewrite
<%- end %>

innodb_buffer_pool_size = <%= node['mysql']['tunable']['innodb_buffer_pool_size'] %>
innodb_log_file_size    = <%= node['mysql']['tunable']['innodb_log_file_size'] %>
innodb_additional_mem_pool_size = <%= node['mysql']['tunable']['innodb_additional_mem_pool_size'] %>
innodb_data_file_path   = <%= node['mysql']['tunable']['innodb_data_file_path'] %>
innodb_flush_log_at_trx_commit = <%= node['mysql']['tunable']['innodb_flush_log_at_trx_commit'] %>
<%- if node['mysql']['tunable']['innodb_flush_method'] %>
innodb_flush_method     = <%= node['mysql']['tunable']['innodb_flush_method'] %>
<%- end %>
innodb_log_buffer_size  = <%= node['mysql']['tunable']['innodb_log_buffer_size'] %>
<%- if node['mysql']['tunable']['innodb_adaptive_flushing'] %>
innodb_adaptive_flushing  = <%= node['mysql']['tunable']['innodb_adaptive_flushing'] %>
<%- end %>
<%- if node['mysql']['tunable']['innodb_adaptive_flushing_method'] %>
innodb_adaptive_flushing_method = <%= node['mysql']['tunable']['innodb_adaptive_flushing_method'] %>
<%- end %>
<%- if node['mysql']['tunable']['innodb_adaptive_checkpoint'] %>
innodb_adaptive_checkpoint = <%= node['mysql']['tunable']['innodb_adaptive_checkpoint'] %>
<%- end %>
